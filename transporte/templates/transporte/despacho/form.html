{% extends 'transporte/base.html' %}

{% block title %}{% if form.instance.id %}Editar{% else %}Nuevo{% endif %} Despacho - LogiTrack{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas {% if form.instance.id %}fa-edit{% else %}fa-plus{% endif %} me-2"></i>
                    {% if form.instance.id %}Editar{% else %}Nuevo{% endif %} Despacho
                </h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.referencia.id_for_label }}" class="form-label">Referencia *</label>
                            {{ form.referencia }}
                            {% if form.referencia.errors %}
                                <div class="text-danger">{{ form.referencia.errors }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.estado.id_for_label }}" class="form-label">Estado *</label>
                            {{ form.estado }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.ruta.id_for_label }}" class="form-label">Ruta *</label>
                            {{ form.ruta }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.cliente.id_for_label }}" class="form-label">Cliente *</label>
                            {{ form.cliente }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.carga.id_for_label }}" class="form-label">Carga *</label>
                            {{ form.carga }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.fecha_programada.id_for_label }}" class="form-label">Fecha Programada</label>
                            {{ form.fecha_programada }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.fecha_entrega.id_for_label }}" class="form-label">Fecha de Entrega</label>
                            {{ form.fecha_entrega }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.peso_total_kg.id_for_label }}" class="form-label">Peso Total (kg)</label>
                            {{ form.peso_total_kg }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.volumen_m3.id_for_label }}" class="form-label">Volumen (m³)</label>
                            {{ form.volumen_m3 }}
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.costo_transporte.id_for_label }}" class="form-label">Costo de Transporte</label>
                            {{ form.costo_transporte }}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="{{ form.seguro_carga.id_for_label }}" class="form-label">Seguro de Carga</label>
                            {{ form.seguro_carga }}
                        </div>
                    </div>

                    <div id="terrestre-fields">
                        <h5 class="border-bottom pb-2 mt-4">Recursos Terrestres</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.vehiculo.id_for_label }}" class="form-label">Vehículo</label>
                                {{ form.vehiculo }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.conductor.id_for_label }}" class="form-label">Conductor</label>
                                {{ form.conductor }}
                            </div>
                        </div>
                    </div>

                    <div id="aereo-fields">
                        <h5 class="border-bottom pb-2 mt-4">Recursos Aéreos</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.aeronave.id_for_label }}" class="form-label">Aeronave</label>
                                {{ form.aeronave }}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.piloto.id_for_label }}" class="form-label">Piloto</label>
                                {{ form.piloto }}
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.observaciones.id_for_label }}" class="form-label">Observaciones</label>
                        {{ form.observaciones }}
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'transporte:despacho_list' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i> 
                            {% if form.instance.id %}Actualizar{% else %}Crear{% endif %} Despacho
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const rutaSelect = document.getElementById('{{ form.ruta.id_for_label }}');
        const terrestreFields = document.getElementById('terrestre-fields');
        const aereoFields = document.getElementById('aereo-fields');
        
        function toggleTransporteFields() {
            const selectedOption = rutaSelect.options[rutaSelect.selectedIndex];
            const tipoTransporte = selectedOption.text.includes('TERRESTRE') ? 'TERRESTRE' : 
                                  selectedOption.text.includes('AÉREO') ? 'AEREO' : '';
            
            if (tipoTransporte === 'TERRESTRE') {
                terrestreFields.style.display = 'block';
                aereoFields.style.display = 'none';
            } else if (tipoTransporte === 'AEREO') {
                terrestreFields.style.display = 'none';
                aereoFields.style.display = 'block';
            } else {
                terrestreFields.style.display = 'block';
                aereoFields.style.display = 'block';
            }
        }
        
        rutaSelect.addEventListener('change', toggleTransporteFields);
        toggleTransporteFields(); // Initial state
    });
</script>

<style>
    input, select, textarea {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }
    
    input:focus, select:focus, textarea:focus {
        border-color: #2c5aa0;
        box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
        outline: none;
    }
    
    .form-label {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
</style>
{% endblock %}